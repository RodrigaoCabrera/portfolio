---
import Card from "./Card.astro";
import { getProjects } from "../libs/get-projects";
import Tabs from "./Tabs.astro";
const STRAPI_URL = import.meta.env.STRAPI_URL;
const baseUrl = "http://localhost:4321/";
const url = new URL(Astro.request.headers.get("referer"), baseUrl);
console.log({ url: Astro.request.headers.get("referer") });
const projectType = url.searchParams.get("type") || "";

const projects = await getProjects(
  `?populate[image][fields][0]=url&fields[0]=title&fields[1]=description&fields[2]=type&fields[3]=github_link&fields[4]=deploy_link&filters[type][$contains]=${projectType}`
);
---

<section>
  <Tabs queryParams={projectType || "All"} />
  <div>
    {
      projects.data.map(({ image, title, type, id }) => (
        <Card
          image={`${STRAPI_URL}${image[0].url}`}
          title={title}
          type={type}
          id={id}
        />
      ))
    }
  </div>
</section>

<style>
  div {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(163px, 1fr));
    gap: 12px;
    padding: 16px 0;
  }
</style>
